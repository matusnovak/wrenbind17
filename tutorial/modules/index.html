<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="8. Modules and files #  Wren support modularity (official documentation here), but does not exactly work out of the box. WrenBind17 fills this gap by adding a file load function that works using a list of look-up paths.
If you are familiar with Python, this is almost the same as the Python home path for loading modules.
std::vector&lt;std::string&gt; paths = { &#34;some/relative/path&#34;, &#34;C:/absolute/path&#34; }; wren::VM vm(paths); It is highly advised to use absolute paths.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="8. Modules and files" />
<meta property="og:description" content="8. Modules and files #  Wren support modularity (official documentation here), but does not exactly work out of the box. WrenBind17 fills this gap by adding a file load function that works using a list of look-up paths.
If you are familiar with Python, this is almost the same as the Python home path for loading modules.
std::vector&lt;std::string&gt; paths = { &#34;some/relative/path&#34;, &#34;C:/absolute/path&#34; }; wren::VM vm(paths); It is highly advised to use absolute paths." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://matusnovak.github.io/wrenbind17/tutorial/modules/" />

<title>8. Modules and files | WrenBind17</title>
<link rel="manifest" href="/wrenbind17/manifest.json">
<link rel="icon" href="/wrenbind17/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/wrenbind17/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css" integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY=">
<script defer src="/wrenbind17/en.search.min.0a7a3a9aa866ceb5f9d0342ad615d395091f74e3be96bc1555db73b7876d3085.js" integrity="sha256-Cno6mqhmzrX50DQq1hXTlQkfdOO&#43;lrwVVdtzt4dtMIU="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/wrenbind17"><span>WrenBind17</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li><a href="/wrenbind17/">Home</a></li>
<li><a href="/wrenbind17/tutorial/">Tutorial</a>
<ul>
<li><a href="/wrenbind17/tutorial/install/">1. Installation</a></li>
<li><a href="/wrenbind17/tutorial/hello_world/">2. Hello World</a></li>
<li><a href="/wrenbind17/tutorial/call_wren/">3. Call Wren function</a></li>
<li><a href="https://matusnovak.github.io/wrenbind17/tutorial/types/">4. Supported types</a></li>
<li><a href="https://matusnovak.github.io/wrenbind17/tutorial/execute_code/">5. Executing from file</a></li>
<li><a href="https://matusnovak.github.io/wrenbind17/tutorial/custom_types/">6. Custom types</a></li>
<li><a href="https://matusnovak.github.io/wrenbind17/tutorial/operators/">7. Class operators</a></li>
<li><a href="https://matusnovak.github.io/wrenbind17/tutorial/modules/">8. Modules and files</a></li>
<li><a href="https://matusnovak.github.io/wrenbind17/tutorial/customize/">9. Customize VM</a></li>
<li><a href="https://matusnovak.github.io/wrenbind17/tutorial/fn/">10. Fn.new and callbacks</a></li>
<li><a href="https://matusnovak.github.io/wrenbind17/tutorial/stl/">11. STL containers</a></li>
</ul>
</li>
<li>Api Documentation
<ul>
<li><a href="/wrenbind17/classes/">Classes</a></li>
<li><a href="/wrenbind17/namespaces/">Namespaces</a></li>
<li><a href="/wrenbind17/modules/">Modules</a></li>
<li><a href="/wrenbind17/files/">Files</a></li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/wrenbind17/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>8. Modules and files</strong>

  <label for="toc-control">
    
    <img src="/wrenbind17/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#81-detailed-explanation">8.1. Detailed explanation</a>
      <ul>
        <li><a href="#811-import-ambiguity">8.1.1 Import ambiguity</a></li>
        <li><a href="#812-module-names-for-custom-types">8.1.2. Module names for custom types</a></li>
      </ul>
    </li>
    <li><a href="#82-custom-import-mechanism">8.2. Custom import mechanism</a></li>
    <li><a href="#83-raw-modules">8.3. Raw modules</a></li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="8-modules-and-files">
  8. Modules and files
  <a class="anchor" href="#8-modules-and-files">#</a>
</h1>
<p>Wren support modularity (official documentation <a href="http://wren.io/modularity.html">here</a>), but does not exactly work out of the box. WrenBind17 fills this gap by adding a file load function that works using a list of look-up paths.</p>
<p>If you are familiar with Python, this is almost the same as the Python home path for loading modules.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string<span style="color:#f92672">&gt;</span> paths <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;some/relative/path&#34;</span>,
    <span style="color:#e6db74">&#34;C:/absolute/path&#34;</span>
};
wren<span style="color:#f92672">::</span>VM vm(paths);
</code></pre></div><p>It is highly advised to use absolute paths. You can use relative paths, but they will depend on your current working directory. The default value of the VM constructor is <code>{&quot;./&quot;}</code>. This means that by default the VM will look for files relative to your working directory. If there is a file named <code>./libs/mylib.wren</code> in your working directory, then you can import that file as <code>import &quot;libs/mylib&quot; for XYZ</code>.</p>
<h2 id="81-detailed-explanation">
  8.1. Detailed explanation
  <a class="anchor" href="#81-detailed-explanation">#</a>
</h2>
<p>Consider the following program file structure:</p>
<pre><code>myprogram/
    app.exe
    data/
        main.wren
        libA.wren
        utils/
            libB.wren
</code></pre><p>You have three files: <code>data/main.wren</code>, <code>data/libA.wren</code>, and <code>data/utils/libB.wren</code>. Now, inside of your main, you might have something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// File: data/main.wren
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;libA&#34;</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">XYZ</span>
</code></pre></div><p><strong>This won&rsquo;t work by default.</strong> Because of the default argument for the <code>wren::VM</code> constructor is <code>{&quot;./&quot;}</code>, the libA is being looked for inside of <code>myprogram/./&lt;import name&gt;.wren</code> (assuming the current working directory is <code>myprogram/</code>). What you should do is to construct <code>Wren::VM</code> in the following way:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string<span style="color:#f92672">&gt;</span> paths <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;C:/programs/myprogram/data&#34;</span>
};
wren<span style="color:#f92672">::</span>VM vm(paths);
</code></pre></div><p>Only then the <code>import &quot;libA&quot; for XYZ</code> will work correctly.</p>
<blockquote class="book-hint warning">
  <p><strong>Warning</strong></p>
<p>Relative imports do not work due to the design of the Wren! You will have to use absolute paths. So, how do you import <code>myprogram/data/utils/libB.wren</code> in <code>myprogram/data/libA.wren</code>? You simply use <code>import &quot;utils/libB&quot; for XYZ</code> in that file.</p>

</blockquote>

<h3 id="811-import-ambiguity">
  8.1.1 Import ambiguity
  <a class="anchor" href="#811-import-ambiguity">#</a>
</h3>
<p>If you have two Wren source code files named exactly the same, but in two different lookup paths, only the first file will be loaded. The <code>std::vector&lt;std::string&gt;</code> of paths you use as the first argument of <code>wren::VM</code> constructor is an ordered list of paths. The files are looked for in the order you define it.</p>
<h3 id="812-module-names-for-custom-types">
  8.1.2. Module names for custom types
  <a class="anchor" href="#812-module-names-for-custom-types">#</a>
</h3>
<p>Any module name is permitted as long as it can be a valid Wren string. Slashes such as <code>import &quot;lib/utils/extras&quot; for tokenize</code> is allowed, simply create a module as <code>auto&amp; m = vm.module(&quot;lib/utils/extras&quot;);</code>.</p>
<h2 id="82-custom-import-mechanism">
  8.2. Custom import mechanism
  <a class="anchor" href="#82-custom-import-mechanism">#</a>
</h2>
<p>You can use your own custom mechanism for handling the imports. This is done by defining your own function of the following type:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">typedef</span> std<span style="color:#f92672">::</span>function<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string(
        <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string<span style="color:#f92672">&gt;&amp;</span> paths, 
        <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string<span style="color:#f92672">&amp;</span> name
    )<span style="color:#f92672">&gt;</span> LoadFileFn;
</code></pre></div><p>And using it as this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(...) {
    wren<span style="color:#f92672">::</span>VM vm({<span style="color:#e6db74">&#34;./&#34;</span>});

    <span style="color:#66d9ef">const</span> myLoader <span style="color:#f92672">=</span> [](
        <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>string<span style="color:#f92672">&gt;&amp;</span> paths, 
        <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>string<span style="color:#f92672">&amp;</span> name) <span style="color:#f92672">-&gt;</span> std<span style="color:#f92672">::</span>string {
        
        <span style="color:#75715e">// &#34;paths&#34; - This list comes from the 
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// first argument of the wren::VM constructor.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// &#34;name&#34; - The name of the import.
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">// Return the source code in this function or throw an exception.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// For example you can throw wren::NotFound();
</span><span style="color:#75715e"></span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>;
	};

    vm.setLoadFileFunc(myLoader);
}
</code></pre></div><blockquote class="book-hint warning">
  <p><strong>Warning</strong></p>
<p>Changing the loader function will also modify the <code>wren::VM::runFromModule</code> function. That function depends on the loader. The argument you pass into the <code>runFromModule</code> will become the <code>name</code> parameter in the loader.</p>

</blockquote>

<h2 id="83-raw-modules">
  8.3. Raw modules
  <a class="anchor" href="#83-raw-modules">#</a>
</h2>
<p>You can create any number of modules. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">wren<span style="color:#f92672">::</span>VM vm;
<span style="color:#66d9ef">auto</span><span style="color:#f92672">&amp;</span> m <span style="color:#f92672">=</span> vm.module(<span style="color:#e6db74">&#34;mymodule&#34;</span>);

m.append(R<span style="color:#e6db74">&#34;(</span>
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Vec3</span> {
        construct <span style="color:#a6e22e">new</span> (x, y, z) {
            _x <span style="color:#f92672">=</span> x
            _y <span style="color:#f92672">=</span> y
            _z <span style="color:#f92672">=</span> z
        }
    }
)<span style="color:#e6db74">&#34;);</span>
</code></pre></div><p>Then the module can be used as:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;mymodule&#34;</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">Vec3</span>
</code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





  <div>
    <a class="flex align-center" href="https://github.com/matusnovak/wrenbind17/tree/master/docs/content//Tutorial/modules.md" target="_blank" rel="noopener">
      <img src="/wrenbind17/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#81-detailed-explanation">8.1. Detailed explanation</a>
      <ul>
        <li><a href="#811-import-ambiguity">8.1.1 Import ambiguity</a></li>
        <li><a href="#812-module-names-for-custom-types">8.1.2. Module names for custom types</a></li>
      </ul>
    </li>
    <li><a href="#82-custom-import-mechanism">8.2. Custom import mechanism</a></li>
    <li><a href="#83-raw-modules">8.3. Raw modules</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












